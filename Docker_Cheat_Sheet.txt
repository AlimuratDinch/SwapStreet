SwapStreet Docker Compose Cheat Sheet
=====================================

1. Build/Rebuild & Start Containers
---------------------------
# Build images and start all containers in foreground
docker compose up --build

# Build images and start all containers in background (detached - terminal is free to use)
docker compose up -d --build

- For Development -
docker-compose -f docker-compose.dev.yml up --build

# Backend only (postgres)
docker compose -f docker-compose.dev.yml up backend --build

- For Production -
docker-compose -f docker-compose.prod.yml up -d


2. Stop & Remove Containers
---------------------------
# Stop all running containers in this Compose project
docker compose down

# Stop and remove containers, networks, and default volumes
docker compose down -v

3. View Logs
------------
# Show logs for all containers
docker compose logs -f

# Show logs for a specific container
docker compose logs -f backend
docker compose logs -f postgres
docker compose logs -f pgadmin

4. Access Containers
--------------------
# Open a bash shell inside the backend container
docker compose exec backend bash

# Open a psql session inside the postgres container
docker compose exec postgres psql -U postgres -d swapstreet-db

5. Remove Orphaned Containers
-----------------------------
docker compose up --remove-orphans

6. One-Liners for Dev Reset
---------------------------
# Stop all containers (even unrelated ones)
docker stop $(docker ps -q)

# Remove all containers
docker rm $(docker ps -aq)

# Rebuild and start fresh
docker compose down -v
docker compose up --build

7. Dev Environment Addresses
----------------------------
Backend Swagger -> http://localhost:8080/index.html
PgAdmin         -> http://localhost:5050/


8. Example .env File
> Moved to .en.example File

9. Migrations
--------------------
dotnet ef migrations add <name> --context AppDbContext
dotnet ef database update --context AppDbContext

10. Testing
--------------------
# unit test only
dotnet test

# Run tests and collect coverage
dotnet test /p:CollectCoverage=true /p:CoverletOutputFormat=opencover /p:CoverletOutput=./coverage/
dotnet test backend.Tests/backend.Tests.csproj /p:CollectCoverage=true /p:CoverletOutputFormat=opencover /p:CoverletOutput=coverage.xml


# Optional: generate HTML report
reportgenerator -reports:./coverage/coverage.opencover.xml -targetdir:./coverage-report -reporttypes:Html


11. Formatting Code 
--------------------
# Format Backend

dotnet format backend.sln\

12. Creating JWT secrets for Development

# Create 32 byte key
openssl rand -base64 32